<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Ghost Hunt</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<style>
html, body {
  margin: 0;
  padding: 0;
  overflow: hidden;
  background: black;
  font-family: monospace;
}

#camera {
  position: fixed;
  width: 100vw;
  height: 100vh;
  object-fit: cover;
  z-index: 1;
}

#ghost {
  position: fixed;
  width: 180px;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  opacity: 0;
  z-index: 4;
  pointer-events: none;
}

#hud {
  position: fixed;
  top: 10px;
  left: 10px;
  color: #00ffcc;
  z-index: 5;
  text-shadow: 0 0 8px #00ffcc;
}

#emf {
  width: 160px;
  height: 12px;
  background: #003333;
  margin-top: 6px;
}

#emfFill {
  height: 100%;
  width: 0%;
  background: #00ffcc;
}

#captureBtn {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  padding: 14px 30px;
  font-size: 18px;
  background: #00ffcc;
  color: black;
  border: none;
  z-index: 6;
  display: none;
}
</style>
</head>

<body>

<video id="camera" autoplay playsinline></video>
<img id="ghost" src="ghost.png">

<div id="hud">
  <div id="heading">---</div>
  <div id="status">Initializing...</div>
  <div id="timer">Time: 300</div>
  <div id="emf"><div id="emfFill"></div></div>
</div>

<button id="captureBtn">CAPTURE</button>

<audio id="beep" src="beep.mp3"></audio>

<script>
/* =====================
   CORE
===================== */

let playerLat, playerLon, heading = 0;
let timeLeft = 300;
let activeGhost = null;

const camera = document.getElementById("camera");
const ghost = document.getElementById("ghost");
const headingEl = document.getElementById("heading");
const status = document.getElementById("status");
const timer = document.getElementById("timer");
const emfFill = document.getElementById("emfFill");
const captureBtn = document.getElementById("captureBtn");
const beep = document.getElementById("beep");

const ghosts = [];
const ghostCount = 3;

// ðŸ”´ CHANGE THIS TO YOUR TEST LOCATION
let ghostLat = -26.41003;
let ghostLon = 152.92618;

/* =====================
   CONSTANTS
===================== */

const REVEAL_DISTANCE = 35;
const CAPTURE_DISTANCE = 10;
const MOVE_INTERVAL = 4000;

/* =====================
   CAMERA
===================== */

navigator.mediaDevices.getUserMedia({
  video: { facingMode: "environment" },
  audio: false
}).then(stream => camera.srcObject = stream);

/* =====================
   COMPASS
===================== */

window.addEventListener("deviceorientation", e => {
  if (e.alpha === null) return;
  heading = e.alpha;
  headingEl.innerText = "Heading: " + Math.round(heading);
});

/* =====================
   GPS
===================== */

navigator.geolocation.watchPosition(p => {
  playerLat = p.coords.latitude;
  playerLon = p.coords.longitude;
}, err => alert("GPS error"), { enableHighAccuracy: true });

/* =====================
   HELPERS
===================== */

function dist(a,b,c,d){
  const R=6371e3;
  const dLat=(c-a)*Math.PI/180;
  const dLon=(d-b)*Math.PI/180;
  return R*2*Math.atan2(Math.sqrt(
    Math.sin(dLat/2)**2+
    Math.cos(a*Math.PI/180)*Math.cos(c*Math.PI/180)*Math.sin(dLon/2)**2
  ),Math.sqrt(1));
}

function bearing(a,b,c,d){
  const y=Math.sin((d-b)*Math.PI/180)*Math.cos(c*Math.PI/180);
  const x=Math.cos(a*Math.PI/180)*Math.sin(c*Math.PI/180)-
    Math.sin(a*Math.PI/180)*Math.cos(c*Math.PI/180)*Math.cos((d-b)*Math.PI/180);
  return (Math.atan2(y,x)*180/Math.PI+360)%360;
}

/* =====================
   GHOST SETUP
===================== */

function spawnGhost(){
  return {
    lat: ghostLat + (Math.random()-0.5)*0.0003,
    lon: ghostLon + (Math.random()-0.5)*0.0003,
    alive: true
  };
}

function initGhosts(){
  for(let i=0;i<ghostCount;i++) ghosts.push(spawnGhost());
}

/* =====================
   GHOST AI
===================== */

function moveGhosts(){
  ghosts.forEach(g=>{
    if(!g.alive) return;
    const angle = Math.random()*Math.PI*2;
    g.lat += Math.cos(angle)*0.0001;
    g.lon += Math.sin(angle)*0.0001;
  });
}

/* =====================
   UPDATE LOOP
===================== */

setInterval(()=>{
  if(!playerLat) return;

  activeGhost = null;
  let closest = 999;

  ghosts.forEach(g=>{
    if(!g.alive) return;
    const d = dist(playerLat,playerLon,g.lat,g.lon);
    if(d<closest){ closest=d; activeGhost=g; }
  });

  if(!activeGhost) return;

  const b = bearing(playerLat,playerLon,activeGhost.lat,activeGhost.lon);
  const diff = Math.abs(b-heading);
  const ang = Math.min(diff,360-diff);

  emfFill.style.width = Math.min(100,(1-closest/50)*100)+"%";

  if(closest<REVEAL_DISTANCE && ang<20){
    ghost.style.opacity=1;
    if(closest<CAPTURE_DISTANCE) captureBtn.style.display="block";
  } else {
    ghost.style.opacity=0;
    captureBtn.style.display="none";
  }

  if(closest<25) beep.play();

  status.innerText="Ghosts remaining: "+ghosts.filter(g=>g.alive).length;
},500);

/* =====================
   CAPTURE
===================== */

captureBtn.onclick=()=>{
  if(activeGhost){
    activeGhost.alive=false;
    ghost.style.opacity=0;
    captureBtn.style.display="none";
    const log=JSON.parse(localStorage.getItem("captures")||"[]");
    log.push(Date.now());
    localStorage.setItem("captures",JSON.stringify(log));
  }
};

/* =====================
   TIMER
===================== */

setInterval(()=>{
  timeLeft--;
  timer.innerText="Time: "+timeLeft;
  if(timeLeft<=0) location.reload();
},1000);

/* =====================
   START
===================== */

initGhosts();
setInterval(moveGhosts,MOVE_INTERVAL);
</script>

</body>
</html>
